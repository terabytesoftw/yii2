Class Autoloading
=================

Yii relies on the [class autoloading mechanism](https://www.php.net/manual/en/language.oop5.autoload.php) to locate and
include all required class files.
The loader itself is generated by Composer and complies with the [PSR-4 standard](https://github.com/php-fig/fig-standards/blob/master/accepted/PSR-4-autoloader.md).

> Note: For simplicity of description, in this section we will only talk about autoloading of classes. However, keep in
  mind that the content we are describing here applies to autoloading of interfaces and traits as well.


## Configuring autoloader <span id="configuring-autoloader"></span>

Since Yii uses Composer-generated autoloader, to configure it, `composer.json` should be used:

```json
{
    "name": "myorg/myapp",
    "autoload": {
        "psr-4": {
            "app\\": "src/"
        }
    },
    "autoload-dev": {
        "psr-4": {
            "tests\\": "tests/"
        }
    }
}
```

Note that test-specific requirements are in `autoload-dev` in order not to pollute autoloader in production where 
Composer is used with `--no-dev` flag.

See [Composer documentation](https://getcomposer.org/doc/01-basic-usage.md#autoloading) for details.

After configuration is done, run `composer dump-autoload` to generate autoloader. Note that it should be done after
each re-configuration.

In order for your application to be aware of autoloader, require `vendor/autoload.php` in your entry script.
For web application it is typically `index.php`, for console it's `yii`:

```php
<?php

// comment out the following two lines when deployed to production
defined('YII_DEBUG') or define('YII_DEBUG', true);
defined('YII_ENV') or define('YII_ENV', 'dev');

require __DIR__ . '/../vendor/autoload.php';

$config = require __DIR__ . '/../config/web.php';

(new yii\web\Application($config))->run();
```


## Using autoloader <span id="using-autoloader"></span>

To use the class autoloader, you should follow two simple rules when creating and naming your classes:

* Each class must be under a [namespace](https://www.php.net/manual/en/language.namespaces.php) (for example, `foo\bar\MyClass`)
* Each class must be saved in an individual file whose path matches namespace and name matches class name with `.php` at
  the end of it.

> Note: In fact, you can break the second rule if you need to store a class in a directory that doesn't match the
> namespace.
> See [Composer documentation](https://getcomposer.org/doc/01-basic-usage.md#autoloading).

For example, if a class name and namespace is `foo\bar\MyClass` the file would be `bar/MyClass.php` and `foo` will be
mapped according to `composer.json` autoloader definition.

When using the [Project Template](start-installation.md), you may put your classes under the top-level
namespace `app` that is pre-defined for you.
A class name like `app\components\MyClass` can be resolved into the class file `AppBasePath/components/MyClass.php`.

To add a custom namespace to the autoloader, you need to define it in your `composer.json` autoload section.
For example, to load classes in the `foo` namespace that are located in the `path/to/foo` directory you would add:

```json
{
    "autoload": {
        "psr-4": {
            "foo\\": "path/to/foo/"
        }
    }
}
```

After modifying `composer.json`, remember to run `composer dump-autoload` to regenerate the autoloader.


## Class Map <span id="class-map"></span>

Composer supports the *class map* feature, which maps class names to the corresponding class file paths.
When the autoloader is loading a class, it will first check if the class is found in the map. If so, the corresponding
file path will be included directly without further checks. This makes class autoloading superfast.

You may add classes to the class map in your `composer.json`:

```json
{
    "autoload": {
        "classmap": [
            "path/to/MyClass.php",
            "legacy/classes/"
        ]
    }
}
```

This is particularly useful for:
- Legacy classes that don't follow PSR-4 standards
- Classes that need to be loaded
- Third-party libraries without proper namespace structure

After modifying the classmap, remember to run `composer dump-autoload` to regenerate the autoloader.


## Using Other Autoloaders <span id="using-other-autoloaders"></span>

Because Yii embraces Composer as a package dependency manager, it is recommended that you also install
the Composer autoloader. 

If you're using third-party libraries that have their own autoloaders, you should also install those.

When using multiple autoloader, you should include the `vendor/autoload.php` file which contains the Composer
autoloader.
For example, the following code is extracted from the [entry script](structure-entry-scripts.md) of 
the [Project Template](start-installation.md):

```php
require __DIR__ . '/../vendor/autoload.php';
```

You may use the Composer autoloader alone.
However, you must follow the rules set by Composer in order for your classes to be autoloader.


## Autoloading Extension Classes <span id="autoloading-extension-classes"></span>

The autoloader is capable of autoloading [extension](structure-extensions.md) classes.

The sole requirement is that an extension specifies the `autoload` section correctly in its `composer.json` file. 
Please refer to the [Composer documentation](https://getcomposer.org/doc/04-schema.md#autoload) for more details about 
specifying `autoload`.

Extension classes are automatically available once the extension is installed via Composer.
